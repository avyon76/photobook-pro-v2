<!doctype html><html lang="cs"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Products Probe</title><style>body{font-family:-apple-system,'SF Pro Text','Segoe UI',Roboto,Helvetica,Arial;margin:0;background:linear-gradient(160deg,#eef5ff,#f7fbff)}.wrap{max-width:1200px;margin:28px auto;padding:16px}.card{backdrop-filter:blur(16px);background:rgba(255,255,255,.6);border:1px solid rgba(255,255,255,.7);border-radius:16px;box-shadow:0 8px 40px rgba(0,0,0,.12);padding:16px;margin-bottom:12px}label{display:block;margin:10px 0 4px;font-weight:600}input,select{padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:rgba(255,255,255,.85);outline:none}input[type=text]{width:100%}.row{display:flex;gap:12px;flex-wrap:wrap}.row>*{flex:1 1 180px}button{padding:10px 14px;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:#fff;cursor:pointer;font-weight:600}button.primary{background:#4dabff;color:#fff;border:none}table{width:100%;border-collapse:separate;border-spacing:0 8px}th,td{padding:10px;background:#fff;border:1px solid rgba(0,0,0,.06)}th{background:#f6f9ff;text-align:left}img.thumb{width:56px;height:56px;object-fit:cover;border-radius:8px;border:1px solid rgba(0,0,0,.06)}.muted{color:rgba(0,0,0,.6)}</style></head><body><div class="wrap"><h2>Products Probe</h2><div class="card"><div class="row"><div><label>Base URL</label><input id="base" type="text" readonly></div><div><label>API Key</label><input id="key" type="text" readonly></div><div style="display:flex;gap:8px;align-items:flex-end"><button id="ping" class="primary">Ping</button><span id="pingStatus" class="muted">–</span></div></div><div class="row"><div><label>Filtrovat</label><input id="q" type="text" placeholder="název / sku"></div><div><label>Počet</label><select id="limit"><option>20</option><option selected>50</option><option>100</option></select></div><div style="display:flex;gap:8px;align-items:flex-end"><button id="load" class="primary">Načíst</button><button id="exportCsv">Export CSV</button><button id="exportJson">Export JSON</button></div></div></div><div class="card"><div id="tableWrap">–</div></div><div class="card"><h3>Debug JSON</h3><textarea id="debug" style="width:100%;min-height:120px"></textarea></div></div><script>const K_CFG="pbp.bridge.config",K_MAP="pbp.sku.map";const $=s=>document.querySelector(s);const base=$("#base"),key=$("#key"),pingBtn=$("#ping"),pingStatus=$("#pingStatus"),q=$("#q"),limit=$("#limit"),loadBtn=$("#load"),table=$("#tableWrap"),debug=$("#debug");const exportCsvBtn=$("#exportCsv"),exportJsonBtn=$("#exportJson");let last=[];function loadCfg(){try{const raw=localStorage.getItem(K_CFG);if(!raw)return;const c=JSON.parse(raw);base.value=c.baseUrl||"";key.value=c.apiKey||""}catch(e){}}function csvEsc(v){if(v==null)return"";const s=String(v);return/[",\n]/.test(s)?'"'+s.replace(/"/g,'""')+'"':s}function exportCSV(rows){const head=["id","name","sku","price","currency","status","categories","image"];const out=[head.join(",")];for(const r of rows){out.push([r.id,r.name,r.sku,r.price,r.currency||"",r.status||"",(r.categories||[]).join("|"),r.image||""].map(csvEsc).join(","))}const blob=new Blob([out.join("\n")],{type:"text/csv"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="products.csv";a.click()}function exportJSON(rows){const blob=new Blob([JSON.stringify(rows,null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="products.json";a.click()}function render(rows){const head=`<table><thead><tr><th>ID</th><th>Název</th><th>SKU</th><th>Cena</th><th>Stav</th></tr></thead><tbody>`;const body=rows.map(r=>`<tr><td>${r.id}</td><td>${r.name||""}</td><td>${r.sku||""}</td><td>${r.price!=null?r.price:""} ${r.currency||""}</td><td>${r.status||""}</td></tr>`).join("");table.innerHTML=head+body+"</tbody></table>"}async function ping(){pingStatus.textContent="…";try{const res=await fetch(base.value.replace(/\/$/,"")+"/ping",{headers:{"X-PBP-API-Key":key.value||""}});pingStatus.textContent=res.ok?"OK":"ERR";debug.value=await res.text()}catch(e){pingStatus.textContent="ERR";debug.value=String(e)}}async function loadProducts(){table.textContent="Načítám…";let url=base.value.replace(/\/$/,"")+"/products?limit="+encodeURIComponent(limit.value||"50");if(q.value)url+="&q="+encodeURIComponent(q.value);try{const res=await fetch(url,{headers:{"Content-Type":"application/json","X-PBP-API-Key":key.value||""}});const txt=await res.text();debug.value=txt;if(!res.ok){table.textContent="HTTP "+res.status;return}let data;try{data=JSON.parse(txt)}catch(e){table.textContent="Neplatný JSON";return}const arr=Array.isArray(data)?data:(Array.isArray(data.items)?data.items:[]);const rows=[];for(const p of arr){const id=p.id??p.product_id??p.ID??p.wp_id??null;const name=p.name??p.title??p.post_title??"";const sku=p.sku??p.code??"";const price=p.price??p.regular_price??p.amount??null;const currency=p.currency??p.ccy??"";const status=p.status??p.post_status??"";const categories=p.categories?(Array.isArray(p.categories)?p.categories:[p.categories]):(p.category?[p.category]:[]);let image="";if(p.image)image=typeof p.image==="string"?p.image:(p.image.src||p.image.url||"");else if(Array.isArray(p.images)&&p.images.length)image=p.images[0].src||p.images[0].url||"";rows.push({id,name,sku,price,currency,status,categories,image})}last=rows;render(rows)}catch(e){table.textContent="Výjimka";debug.value=String(e)}}loadCfg();pingBtn.addEventListener("click",ping);loadBtn.addEventListener("click",loadProducts);exportCsvBtn.addEventListener("click",()=>exportCSV(last));exportJsonBtn.addEventListener("click",()=>exportJSON(last));</script></body></html>