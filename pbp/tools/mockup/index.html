<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mockup Studio (beta)</title>
  <style>
    :root{--glass: rgba(255,255,255,.6);--radius:16px;--shadow:0 8px 40px rgba(0,0,0,.12)}
    body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Text','Segoe UI',Roboto,Helvetica,Arial;margin:0;background:linear-gradient(160deg,#eef5ff,#f7fbff)}
    .wrap{max-width:1100px;margin:28px auto;padding:16px}
    .hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .card{backdrop-filter: blur(16px);background:var(--glass);border:1px solid rgba(255,255,255,.7);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .grid{display:grid;grid-template-columns:330px 1fr;gap:12px}
    .controls label{display:block;font-weight:600;margin:12px 0 4px}
    .controls input, .controls select{width:100%;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:rgba(255,255,255,.85);outline:none}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    button{padding:10px 14px;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:#fff;cursor:pointer;font-weight:600}
    button.primary{background:#4dabff;color:#fff;border:none}
    canvas{width:100%;height:auto;background:#f8fafc;border-radius:14px;border:1px solid rgba(0,0,0,.06)}
    .muted{color:rgba(0,0,0,.6)}
    .bgchip{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid rgba(0,0,0,.1);margin:2px;cursor:pointer}
    .layer{display:flex;align-items:center;justify-content:space-between;border:1px dashed rgba(0,0,0,.15);padding:8px;border-radius:10px;margin-bottom:6px;background:rgba(255,255,255,.5)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hdr">
      <div>
        <h2 data-i18n="mockup.title">Mockup Studio (beta)</h2>
        <div class="muted" data-i18n="mockup.desc">Sestav rychlou scénu z lokálních obrázků a exportuj PNG.</div>
      </div>
      <div>
        <label for="langSel" data-i18n="lang">Jazyk</label>
        <select id="langSel">
          <option value="cs">CS</option>
          <option value="en">EN</option>
        </select>
      </div>
    </div>

    <div class="grid">
      <div class="card controls">
        <label data-i18n="mockup.bg">Pozadí</label>
        <div id="bgs">
          <span class="bgchip" data-bg="solid:#ffffff">Solid · #fff</span>
          <span class="bgchip" data-bg="solid:#f5f9ff">Solid · #f5f9ff</span>
          <span class="bgchip" data-bg="grad:blue">Gradient · Blue</span>
          <span class="bgchip" data-bg="grad:sunset">Gradient · Sunset</span>
          <span class="bgchip" data-bg="grad:mint">Gradient · Mint</span>
          <span class="bgchip" data-bg="grid">Grid · subtle</span>
        </div>

        <label data-i18n="mockup.upload">Nahrát obrázek(y)</label>
        <input type="file" id="uploader" accept="image/*" multiple>

        <label data-i18n="mockup.layer">Vrstva</label>
        <div id="layers"></div>

        <div class="row">
          <button id="bringFront" data-i18n="mockup.bringFront">Dopředu</button>
          <button id="sendBack" data-i18n="mockup.sendBack">Dozadu</button>
        </div>

        <label data-i18n="mockup.scale">Měřítko</label>
        <input type="range" min="10" max="300" value="100" id="scale">
        <label data-i18n="mockup.rotate">Rotace</label>
        <input type="range" min="-180" max="180" value="0" id="rotate">
        <label data-i18n="mockup.x">X pozice</label>
        <input type="range" min="-1000" max="1000" value="0" id="posx">
        <label data-i18n="mockup.y">Y pozice</label>
        <input type="range" min="-1000" max="1000" value="0" id="posy">

        <div class="row" style="margin-top:10px">
          <button id="clearBtn" data-i18n="mockup.clear">Vyčistit</button>
          <button class="primary" id="exportBtn" data-i18n="mockup.export">Export PNG</button>
        </div>
      </div>

      <div class="card">
        <h3 data-i18n="mockup.canvas">Plátno</h3>
        <canvas id="cv" width="1800" height="1200"></canvas>
      </div>
    </div>
  </div>

  <script src="/pbp/tools/i18n.js"></script>
  <script>
    const sel = document.getElementById('langSel'); sel.addEventListener('change', e=>PBPI18N.set(e.target.value));

    const cv = document.getElementById('cv');
    const ctx = cv.getContext('2d');
    const uploader = document.getElementById('uploader');
    const scale = document.getElementById('scale');
    const rotate = document.getElementById('rotate');
    const posx = document.getElementById('posx');
    const posy = document.getElementById('posy');
    const layersEl = document.getElementById('layers');
    const bringFront = document.getElementById('bringFront');
    const sendBack = document.getElementById('sendBack');

    let bgStyle = {type:'solid', value:'#f5f9ff'};
    let layers = []; // {img, x, y, scale, rot, name}
    let selected = -1;

    function drawBG(){
      if(bgStyle.type==='solid'){
        ctx.fillStyle = bgStyle.value; ctx.fillRect(0,0,cv.width, cv.height);
      } else if(bgStyle.type==='grad'){
        let g;
        if(bgStyle.value==='blue'){
          g = ctx.createLinearGradient(0,0,cv.width,cv.height);
          g.addColorStop(0,'#e8f3ff'); g.addColorStop(1,'#f9fbff');
        } else if(bgStyle.value==='sunset'){
          g = ctx.createLinearGradient(0,0,cv.width,cv.height);
          g.addColorStop(0,'#ffd6a6'); g.addColorStop(1,'#fde9ff');
        } else if(bgStyle.value==='mint'){
          g = ctx.createLinearGradient(0,0,cv.width,cv.height);
          g.addColorStop(0,'#e6fff5'); g.addColorStop(1,'#f9fffd');
        }
        ctx.fillStyle = g; ctx.fillRect(0,0,cv.width, cv.height);
      } else if(bgStyle.type==='grid'){
        ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,cv.width, cv.height);
        ctx.strokeStyle = 'rgba(0,0,0,0.06)'; ctx.lineWidth = 1;
        for(let x=0; x<cv.width; x+=40){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,cv.height); ctx.stroke();}
        for(let y=0; y<cv.height; y+=40){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(cv.width,y); ctx.stroke();}
      }
    }

    function render(){
      drawBG();
      layers.forEach((L,i)=>{
        const w = L.img.width * (L.scale/100);
        const h = L.img.height * (L.scale/100);
        ctx.save();
        ctx.translate(cv.width/2 + L.x, cv.height/2 + L.y);
        ctx.rotate(L.rot * Math.PI/180);
        ctx.drawImage(L.img, -w/2, -h/2, w, h);
        if(i===selected){
          ctx.strokeStyle = 'rgba(77,171,255,0.9)';
          ctx.lineWidth = 2;
          ctx.strokeRect(-w/2, -h/2, w, h);
        }
        ctx.restore();
      });
    }

    function updateSliders(){
      const L = layers[selected];
      if(!L) return;
      scale.value = L.scale;
      rotate.value = L.rot;
      posx.value = L.x;
      posy.value = L.y;
    }

    function repaintLayersUI(){
      layersEl.innerHTML = '';
      layers.forEach((L,i)=>{
        const div = document.createElement('div');
        div.className = 'layer';
        const title = document.createElement('div');
        title.textContent = L.name;
        const btn = document.createElement('button');
        btn.textContent = (i===selected)?'✓':'Select';
        btn.addEventListener('click', ()=>{ selected = i; updateSliders(); render(); repaintLayersUI();});
        div.appendChild(title); div.appendChild(btn);
        layersEl.appendChild(div);
      });
    }

    uploader.addEventListener('change', async (e)=>{
      const files = Array.from(e.target.files || []);
      for(const f of files){
        const img = new Image();
        img.src = URL.createObjectURL(f);
        await new Promise(res=>{img.onload=res;});
        layers.push({img, x:0, y:0, scale: Math.round(100*1200/Math.max(img.width,img.height)), rot:0, name: f.name});
        selected = layers.length-1;
      }
      repaintLayersUI(); updateSliders(); render();
    });

    scale.addEventListener('input', ()=>{ if(layers[selected]){ layers[selected].scale = +scale.value; render(); }});
    rotate.addEventListener('input', ()=>{ if(layers[selected]){ layers[selected].rot = +rotate.value; render(); }});
    posx.addEventListener('input', ()=>{ if(layers[selected]){ layers[selected].x = +posx.value; render(); }});
    posy.addEventListener('input', ()=>{ if(layers[selected]){ layers[selected].y = +posy.value; render(); }});

    bringFront.addEventListener('click', ()=>{
      if(selected<0) return; const L = layers.splice(selected,1)[0]; layers.push(L); selected = layers.length-1; repaintLayersUI(); render();
    });
    sendBack.addEventListener('click', ()=>{
      if(selected<0) return; const L = layers.splice(selected,1)[0]; layers.unshift(L); selected = 0; repaintLayersUI(); render();
    });

    document.getElementById('clearBtn').addEventListener('click', ()=>{ layers=[]; selected=-1; repaintLayersUI(); render(); });

    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const a = document.createElement('a');
      a.download = 'mockup.png';
      a.href = cv.toDataURL('image/png');
      a.click();
    });

    // Background selection
    document.querySelectorAll('.bgchip').forEach(chip=>{
      chip.addEventListener('click', ()=>{
        const val = chip.getAttribute('data-bg');
        if(val.startsWith('solid:')){ bgStyle={type:'solid', value:val.split(':')[1]}; }
        else if(val.startsWith('grad:')){ bgStyle={type:'grad', value:val.split(':')[1]}; }
        else if(val==='grid'){ bgStyle={type:'grid'}; }
        render();
      });
    });

    // initial paint
    render();
  </script>
</body>
</html>
