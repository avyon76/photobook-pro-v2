name: Bootstrap PBP Content
on:
  workflow_dispatch: {}

permissions:
  contents: write
  pull-requests: write

jobs:
  make-pr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Create feature branch
        run: |
          git checkout -b feat/products-v35-1

      - name: Write content files
        shell: bash
        run: |
          set -e
          mkdir -p content/products content/pages content/pricing content/shipping docs .github/workflows

          cat > content/products/prints.md <<'EOF'
# Foto tisky (malý formát)
**Formáty:** 9×13, 10×15, 13×18, 15×21, A4 (21×29,7).  
**Materiály:** fotografický papír (mat / polomat / lesk).  
**Spadávka:** +3 mm; bezpečná zóna 5 mm. **DPI:** 300. **Profil:** sRGB.
**Okraje:** bez okraje / s bílým rámečkem. **Výroba:** 1–2 dny (expres na dotaz).

### Prepress
- Texty/loga min. 5 mm od ořezu, linky ≥ 0,3 pt.
- Vstupy JPG/PNG (8bit, sRGB); PDF možné se spadávkou 3 mm.
EOF

          cat > content/products/large-format.md <<'EOF'
# Velkoformátový tisk (LF)
**Produkty:** plakáty, fine-art, desky (PVC/Kapa/Dibond), akryl, rámování.  
**Materiály:** Plakát 200 g, FineArt 308 g, PVC 5 mm, Kapa 10 mm, Dibond 3 mm, Akryl 5/10 mm.  
**Povrch:** mat/lesk + laminace. **Max šíře:** až 320 cm. **Závěsy:** lišta, háčky, skryté.

### Prepress
- Spadávka: plakáty 5 mm; desky doporučujeme 10 mm.
- DPI: 180–240 (z běžné vzdálenosti). Profil: sRGB. Vyhnout se RGB(0,0,0).
**Termíny:** 2–5 dnů (podle materiálu/rámu).
EOF

          cat > content/products/photobooks.md <<'EOF'
# Fotoknihy (Basic / Pro / LayFlat)
**Vazby:** Basic (měkké, PUR), Pro (pevné, lepená/šitá), LayFlat (panorama, dvojlist).
**Papíry:** Silk 170–200 g (Basic), 200–250 g (Pro), LayFlat desky 700–800 g.  
**Rozsah:** od 20 stran, přidávání po 2 (LayFlat po dvojlistech).  
**Rozměry:** A4 na výšku/šířku, čtverec 210×210 / 300×300.

### Studio (AI)
Auto-výběr fotek, inteligentní layout, detekce duplicit, preflight (DPI/spadávka/bezpečné zóny/gamut).

### Data
Interně generujeme tisk s 3 mm spadávkou a bezpečnou zónou 5 mm. Vstupy JPG/PNG (sRGB). PDF po dohodě.
**Výroba:** 3–7 dnů.
EOF

          cat > content/products/calendars.md <<'EOF'
# Kalendáře
**Formát:** A3 na výšku (horní obraz, spodní kalendárium), 13 listů (titul + 12 měsíců).  
**Vazba:** kroužková s háčkem. **Papír:** 200–250 g, mat/lesk.

### Kalendária
- minimalistické
- rodinné (více řádků)
- firemní (logo)

**Prepress:** spad 3 mm, bezpečná zóna 5 mm, sRGB, text ≥ 8 pt. **Výroba:** 3–5 dnů.
EOF

          cat > content/products/magnets.md <<'EOF'
# Foto magnety
**Formáty:** 5×5, 7×7, 10×10, 10×15 (zaoblené rohy). **Sety:** 3×1, 2×2, 4×1.  
**Materiál:** tisk + magnetická fólie; povrch mat/lesk. **Balení:** dárková krabička (volitelně).

### Prepress
Spad 2–3 mm, bezpečná zóna 4–5 mm, sRGB, 300 dpi.
**Výroba:** 1–3 dny dle množství.
EOF

          cat > content/products/frames.md <<'EOF'
# Rámy & pasparty
**Rámy:** dřevo / hliník (tenký / standard profil), barvy: černá, bílá, přírodní, hliník.  
**Zasklení:** float sklo / plexi / antireflex (AR). **Závěsy:** háčky / struna.  
**Pasparty:** bílé / černé, tloušťka 1,4–2,0 mm, vnitřní výřez na míru.

### Prepress pro rámování
- Doporučujeme 5–10 mm spadávku pro přesný ořez.
- Pokud bude pasparta, držte důležité motivy min. 10–15 mm od okraje obrazu.

### Orientační ceny (placeholdery)
- rám od **399 Kč**, AR sklo +**150 Kč**, pasparta +**129 Kč**, závěsy v ceně.  
Ceny upřesníme podle formátu a materiálu.
EOF

          cat > content/pages/home.md <<'EOF'
# Photobook Pro
Tiskneme **fotoknihy, kalendáře, tisky, magnety a velkoformát** v prémiové kvalitě.
Brzy spustíme **konfigurátor** s chytrým výběrem fotek a automatickými layouty.

- Rychlá výroba v Praze
- Preflight kontrola dat
- Možnost dárkového balení

**Začněte produktem v menu nahoře.**
EOF

          cat > content/pages/pricing.md <<'EOF'
# Ceník a promo akce
Ceny se liší dle materiálu, rozměru a počtu stran/ks.
Aktuální akce: BOGO, druhá kniha se stejnou konfigurací, bundle sety.

> Finální ceník zveřejníme při spuštění konfigurátoru. Všechny ceny jsou v CZK vč. DPH.
EOF

          cat > content/pages/shipping.md <<'EOF'
# Doprava a doručení
**Zásilkovna:** výdejní místa (menší zásilky).  
**Kurýr:** door-to-door.  
**XL/Fragile:** rámy, desky – speciální balení a manipulace.

- Pečlivé balení (rohy, výztuhy, folie).
- Více položek může být rozděleno do více balíků.
- Osobní odběr po dohodě.

> Přesné sazby a termíny potvrzujeme v objednávce dle konfigurace.
EOF

          cat > content/pages/faq.md <<'EOF'
# FAQ
**Jak dlouho trvá výroba?**  
Tisky 1–2 dny, magnety 1–3 dny, kalendáře 3–5 dnů, fotoknihy 3–7 dnů, LF a rámování 2–5 dnů.

**Jaká data dodávat?**  
JPG/PNG v sRGB, 300 dpi (LF 180–240 dpi). Spad: 3–10 mm dle produktu, bezpečná zóna 5–10 mm.

**Barevnost a kalibrace?**  
Pracujeme v sRGB. Pokud potřebujete přesné firemní barvy, kontaktujte nás (proof/ICC konzultace).

**Změna objednávky / reklamace?**  
Co nejdříve po objednání. Reklamace řešíme individuálně – napište nám s číslem objednávky a fotkami.

**GDPR a bezpečí dat?**  
Vaše data zpracováváme pro výrobu, uchováváme po nezbytně nutnou dobu a chráníme vůči třetím stranám.
EOF

          cat > content/pricing/pricing.cz.json <<'EOF'
{
  "currency": "CZK",
  "vat_percent": 21,
  "price_lists": [
    { "product": "prints",
      "base": [
        {"size_mm":"100x150","paper":"mat","price":9.0},
        {"size_mm":"130x180","paper":"mat","price":12.0},
        {"size_mm":"150x210","paper":"mat","price":19.0}
      ],
      "options": [
        {"name":"lesk","add":0},
        {"name":"polomat","add":0},
        {"name":"bílý rámeček","add":0}
      ],
      "notes": "Placeholder – doplňte reálné ceny."
    },
    { "product": "large-format",
      "base": [
        {"material":"plakát 200g","sqm_price":450},
        {"material":"fineart 308g","sqm_price":890},
        {"material":"PVC 5 mm","sqm_price":990},
        {"material":"Kapa 10 mm","sqm_price":1150},
        {"material":"Dibond 3 mm","sqm_price":1650}
      ],
      "options": [
        {"name":"laminace mat/lesk","sqm_add":180},
        {"name":"rám","from":399}
      ],
      "notes": "Min. účtovaná plocha 0,2 m2."
    },
    { "product": "photobooks",
      "base": [
        {"type":"Basic A4","pages_included":20,"price":599},
        {"type":"Pro A4","pages_included":20,"price":899},
        {"type":"LayFlat 210x210","pages_included":20,"price":1199}
      ],
      "per_two_pages_add": [
        {"Basic A4":39},
        {"Pro A4":59},
        {"LayFlat 210x210":89}
      ],
      "options": [
        {"name":"tvrdé desky (Basic→Pro)","add":300},
        {"name":"dárkové balení","add":149}
      ]
    },
    { "product": "calendars",
      "base": [
        {"format":"A3 na výšku, 13 listů","price":399}
      ],
      "options": [
        {"name":"rodinné kalendárium","add":49},
        {"name":"logo/firemní branding","add":99}
      ]
    },
    { "product": "magnets",
      "base": [
        {"size_mm":"70x70","price":29},
        {"size_mm":"100x100","price":39},
        {"size_mm":"100x150","price":49}
      ],
      "sets": [
        {"name":"3×1","discount_percent":5},
        {"name":"2×2","discount_percent":8},
        {"name":"4×1","discount_percent":10}
      ],
      "options": [
        {"name":"dárková krabička","add":59}
      ]
    }
  ],
  "promotions": [
    {"type":"BOGO","description":"Kup 1, druhý se slevou 50 % (stejná konfigurace)"},
    {"type":"bundle","description":"Set magnetů – cenové zvýhodnění"},
    {"type":"second-book","description":"Druhá fotokniha stejné konfigurace se slevou"}
  ]
}
EOF

          cat > content/pricing/pricing.cz.csv <<'EOF'
product;variant;size/material;unit;price_czk;notes
prints;10x15;mat;ks;9;placeholder
prints;13x18;mat;ks;12;placeholder
prints;15x21;mat;ks;19;placeholder
large-format;plakát 200g;1 m2;m2;450;min. 0,2 m2
large-format;fineart 308g;1 m2;m2;890;min. 0,2 m2
photobooks;Basic A4;20 stran;ks;599;+2 str. +39 Kč
photobooks;Pro A4;20 stran;ks;899;+2 str. +59 Kč
photobooks;LayFlat 210x210;20 stran;ks;1199;+2 str. +89 Kč
calendars;A3 výška;13 listů;ks;399;rodinné kalendárium +49
magnets;70x70;--;ks;29;--
magnets;100x100;--;ks;39;--
magnets;100x150;--;ks;49;--
EOF

          cat > content/shipping/shipping.cz.json <<'EOF'
{
  "currency": "CZK",
  "carriers": [
    {"name":"Zásilkovna","service":"výdejní místo","price":79,"max_size":"standard","notes":"menší zásilky"},
    {"name":"Kurýr","service":"door-to-door","price":129,"max_size":"střední","notes":""},
    {"name":"Kurýr XL/Fragile","service":"nadrozměr/rám/světlocitlivé","price_from":249,"notes":"balení + výztuhy"}
  ],
  "packaging": [
    {"type":"standard","included":true},
    {"type":"XL/fragile","add_price":69,"includes":"rohy, výztuhy, folie"}
  ],
  "rules": [
    "Více položek může být odesláno ve více balících kvůli bezpečnosti.",
    "Osobní odběr po dohodě (0 Kč).",
    "Termíny a ceny se potvrzují v objednávce dle konfigurace."
  ]
}
EOF

          cat > content/shipping/shipping.cz.csv <<'EOF'
carrier;service;price_czk;notes
Zásilkovna;výdejní místo;79;menší zásilky
Kurýr;door-to-door;129;standard
Kurýr XL/Fragile;nadrozměr/rám;249+;speciální balení
EOF

          cat > docs/PhotobookPro_MASTER_BRIEF_v0_1_to_v88_0.txt <<'EOF'
PhotobookPro MASTER BRIEF v0_1 → v88_0
(Placeholder – doplňte aktuální verzi „Bible“; soubor zde držíme kvůli konzistenci balíku.)
EOF

          # Workflows pro budoucí releasy
          cat > .github/workflows/full-bundle-release.yml <<'EOF'
name: Full Bundle Release
on:
  push:
    tags: ['v*']

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node
        if: ${{ hashFiles('studio/**') != '' }}
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Build Studio
        if: ${{ hashFiles('studio/**') != '' }}
        run: |
          cd studio
          npm ci
          npm run build
          cd ..
          mkdir -p dist/studio
          cp -r studio/.next dist/studio 2>/dev/null || true
          [ -d "studio/out" ] && cp -r studio/out dist/studio || true
          [ -d "studio/build" ] && cp -r studio/build dist/studio || true

      - name: Package WP plugin
        run: |
          if [ -d "wp-plugin" ]; then
            (cd wp-plugin && zip -r ../pbp-bridge.zip .)
          fi

      - name: Package Elementor Kit
        run: |
          if [ -d "elementor" ]; then
            zip -r elementor_kit.zip elementor
          fi

      - name: Collect bundle & zip
        run: |
          VERSION="${GITHUB_REF_NAME}"
          mkdir -p bundle
          [ -d dist ] && cp -r dist bundle/dist || true
          [ -f pbp-bridge.zip ] && mv pbp-bridge.zip bundle/ || true
          [ -f elementor_kit.zip ] && mv elementor_kit.zip bundle/ || true
          ls | grep -E 'PhotobookPro_MASTER_BRIEF.*\\.txt' && cp PhotobookPro_MASTER_BRIEF*.txt bundle/ || true
          zip -r pbp_full_install_${VERSION}.zip bundle

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: pbp_full_install_${{ github.ref_name }}.zip
          generate_release_notes: true
EOF

          cat > .github/workflows/pr-bundle-check.yml <<'EOF'
name: PR Bundle Check
on:
  pull_request:
    branches: [ main, master ]

jobs:
  bundle:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Prepare (smoke)
        run: |
          mkdir -p bundle
          echo "PR bundle smoke-check" > bundle/README.txt
      - name: Zip
        run: zip -r pbp_full_install_PR${{ github.event.number }}.zip bundle
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: pbp_full_install_PR${{ github.event.number }}
          path: pbp_full_install_PR${{ github.event.number }}.zip
EOF

      - name: Commit & push branch
        run: |
          set -e
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add -A
          git commit -m "feat: CZ obsah + workflowy + pricing/shipping + FAQ + frames"
          git push origin feat/products-v35-1

      - name: Open PR via API
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
          BASE: ${{ github.event.repository.default_branch }}
        run: |
          PR_TITLE="feat/products-v35-1: CZ obsah + workflowy + pricing/shipping + FAQ + frames"
          PR_BODY="Automaticky vytvořený PR: přidává obsah a workflowy dle pbp_full_install_v35_1."
          curl -s -X POST -H "Authorization: Bearer ${GITHUB_TOKEN}" -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/${REPO}/pulls \
            -d "{\"title\":\"${PR_TITLE}\",\"body\":\"${PR_BODY}\",\"head\":\"feat/products-v35-1\",\"base\":\"${BASE}\"}" \
            > pr.json
          echo "PR response:"; cat pr.json
